<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LAIR | –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ç–æ—Ä –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ü–≤–µ–Ω—Ç—É</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* LAIR Core Palette */
        :root {
            --color-bunker-graphite: #2d2d2d;
            --color-sunset-red: #E05A47;
            --color-warm-white: #F5F5F5;
            --color-card-dark: #3f3f3f;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background-color: var(--color-bunker-graphite);
            color: var(--color-warm-white);
        }
        .card {
            background-color: var(--color-card-dark);
            border-radius: 1rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.3);
        }
        .accent-color {
            color: var(--color-sunset-red);
        }
        
        /* Custom Input Styles */
        .lair-input {
            background-color: #4a4a4a;
            border: 1px solid #666666;
            color: var(--color-warm-white);
            transition: border-color 0.2s;
        }
        .lair-input:focus {
            border-color: var(--color-sunset-red);
            box-shadow: 0 0 0 1px var(--color-sunset-red);
            outline: none;
        }

        /* Accent Slider Styling (Red) */
        input[type=range] {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            background: #5a5a5a;
            border-radius: 4px;
            margin: 8px 0;
            transition: background 0.3s;
        }

        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--color-sunset-red);
            cursor: pointer;
            border-radius: 50%;
            border: 3px solid var(--color-warm-white);
            box-shadow: 0 0 5px var(--color-sunset-red);
        }

        /* Button Styles */
        .lair-btn-primary {
            background-color: var(--color-sunset-red);
            color: white;
            transition: background-color 0.2s, transform 0.1s;
        }
        .lair-btn-primary:hover {
            background-color: #c74d3a;
        }
        .lair-btn-primary:active {
            transform: scale(0.98);
        }
        
        /* Tab navigation */
        .tab-btn {
            background-color: #4a4a4a;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        .tab-btn.active {
            background-color: var(--color-card-dark);
            border-bottom: 3px solid var(--color-sunset-red);
            color: var(--color-sunset-red);
            font-weight: bold;
        }
        
        /* Checkbox custom style */
        input[type="checkbox"] {
            accent-color: var(--color-sunset-red);
            width: 1.25rem;
            height: 1.25rem;
        }
    </style>
</head>
<body class="min-h-screen p-4 md:p-10">

    <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <div class="col-span-1 lg:col-span-3 text-center mb-6">
            <h1 class="text-4xl font-extrabold mb-2 accent-color">LAIR Event Builder <i class="fas fa-desktop ml-1"></i></h1>
            <p class="text-neutral-400">–®–≤–∏–¥–∫–∏–π –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ç–æ—Ä —Ç–∞ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è –æ—Ä–µ–Ω–¥–∏</p>
        </div>

        <div class="col-span-1 lg:col-span-2 space-y-8">
            
            <div class="flex card p-2 justify-around shadow-inner">
                <button onclick="showTab(1)" id="tab-1-btn" class="tab-btn active flex-1 p-3 rounded-lg text-center">1. –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è</button>
                <button onclick="showTab(2)" id="tab-2-btn" class="tab-btn flex-1 p-3 rounded-lg text-center">2. –õ–æ–≥—ñ—Å—Ç–∏–∫–∞/–°–µ—Ä–≤—ñ—Å</button>
                <button onclick="showTab(3)" id="tab-3-btn" class="tab-btn flex-1 p-3 rounded-lg text-center">3. –ö–æ–Ω—Ç–∞–∫—Ç–∏</button>
            </div>

            <div id="tab-1" class="tab-content card p-8 shadow-2xl">
                <h2 class="text-2xl font-bold mb-6 accent-color"><i class="fas fa-gamepad mr-2"></i> –í–∏–±—ñ—Ä –Ü–≥—Ä–æ–≤–æ–≥–æ –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è</h2>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    <div class="input-group">
                        <div class="flex justify-between items-center mb-1">
                            <label class="text-lg">–Ü–≥—Ä–æ–≤—ñ –ù–æ—É—Ç–±—É–∫–∏ (—à—Ç)</label>
                            <span id="laptopCountVal" class="text-3xl font-extrabold accent-color">4</span>
                        </div>
                        <input type="range" id="laptops" min="0" max="40" step="1" value="4" class="w-full">
                        <p class="text-xs text-neutral-400">–û–ø—Ç–∏–º–∞–ª—å–Ω–æ –¥–ª—è —Ç—É—Ä–Ω—ñ—Ä—ñ–≤ —Ç–∞ –≤–µ–ª–∏–∫–∏—Ö –∑–æ–Ω.</p>
                    </div>

                    <div class="input-group">
                        <div class="flex justify-between items-center mb-1">
                            <label class="text-lg">PlayStation 5 (—à—Ç)</label>
                            <span id="ps5CountVal" class="text-3xl font-extrabold accent-color">2</span>
                        </div>
                        <input type="range" id="ps5" min="0" max="10" step="1" value="2" class="w-full">
                        <p class="text-xs text-neutral-400">–î–ª—è —Ñ–∞–Ω–æ–≤–æ—ó –∑–æ–Ω–∏ —Ç–∞ —ñ–≥–æ—Ä –Ω–∞ –¥–∏–≤–∞–Ω—ñ.</p>
                    </div>

                    <div class="input-group">
                        <div class="flex justify-between items-center mb-1">
                            <label class="text-lg">VR –®–æ–ª–æ–º–∏ (Quest 3/2)</label>
                            <span id="vrCountVal" class="text-3xl font-extrabold accent-color">1</span>
                        </div>
                        <input type="range" id="vr" min="0" max="10" step="1" value="1" class="w-full">
                        <p class="text-xs text-neutral-400">–û–±–æ–≤'—è–∑–∫–æ–≤–∞ —É–º–æ–≤–∞: 4—Ö4–º –ø—Ä–æ—Å—Ç–æ—Ä—É –¥–ª—è –≥—Ä–∏.</p>
                    </div>

                    <div class="input-group">
                        <div class="flex justify-between items-center mb-1">
                            <label class="text-lg">–¢–í 50-55" + –°—Ç—ñ–π–∫–∏ (—à—Ç)</label>
                            <span id="tvCountVal" class="text-3xl font-extrabold text-green-400">2</span>
                        </div>
                        <input type="range" id="tv" min="0" max="10" step="1" value="2" class="w-full">
                        <p class="text-xs text-neutral-400">**–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –∫—ñ–ª—å–∫—ñ—Å—Ç—å –¢–í = PS5.**</p>
                    </div>
                </div>
                
                <div class="flex justify-end mt-8">
                    <button onclick="showTab(2)" class="lair-btn-primary py-3 px-6 rounded-lg text-lg"><i class="fas fa-arrow-right mr-2"></i> –î–∞–ª—ñ: –°–µ—Ä–≤—ñ—Å</button>
                </div>
            </div>

            <div id="tab-2" class="tab-content card p-8 shadow-2xl hidden">
                <h2 class="text-2xl font-bold mb-6 accent-color"><i class="fas fa-truck-loading mr-2"></i> –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –°–µ—Ä–≤—ñ—Å—É</h2>
                
                <div class="space-y-8">
                    <div class="bg-neutral-600/30 p-4 rounded-lg">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" id="operator" class="w-6 h-6 rounded border-gray-600 bg-gray-700" checked>
                            <span class="text-xl font-semibold">–¢–µ—Ö–Ω—ñ—á–Ω–∏–π –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä (–û–±–æ–≤'—è–∑–∫–æ–≤–æ –¥–ª—è —ñ–≤–µ–Ω—Ç—ñ–≤ > 6 –æ–¥–∏–Ω–∏—Ü—å)</span>
                        </label>
                        <div class="pl-9 mt-4 text-neutral-300">
                            <p class="mb-3">–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –∑–∞–±–µ–∑–ø–µ—á—É—î –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è, –∫–æ–Ω—Ç—Ä–æ–ª—å –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫—É –≥–æ—Å—Ç–µ–π.</p>
                            <div class="flex items-center gap-4 flex-wrap">
                                <label class="text-lg">–ì–æ–¥–∏–Ω–∏ —Ä–æ–±–æ—Ç–∏ (–º—ñ–Ω. 4 –≥–æ–¥):</label>
                                <div class="flex-grow max-w-md flex items-center gap-4">
                                    <input type="range" id="hours" min="4" max="12" step="1" value="6" class="w-full">
                                    <span id="hoursVal" class="text-3xl font-extrabold accent-color">6</span>
                                    <span>–≥–æ–¥–∏–Ω</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="bg-neutral-600/30 p-4 rounded-lg">
                        <label class="flex items-center space-x-3 cursor-pointer mb-4">
                            <input type="checkbox" id="delivery" class="w-6 h-6 rounded border-gray-600 bg-gray-700" checked>
                            <span class="text-xl font-semibold">–ú–æ–Ω—Ç–∞–∂/–î–µ–º–æ–Ω—Ç–∞–∂ —Ç–∞ –î–æ—Å—Ç–∞–≤–∫–∞</span>
                        </label>
                        
                        <div class="pl-9 space-y-4">
                            <label class="block text-neutral-300">–í–∏–±–µ—Ä—ñ—Ç—å –ó–æ–Ω—É –î–æ—Å—Ç–∞–≤–∫–∏:</label>
                            <select id="deliveryZone" class="w-full lair-input p-3 rounded-lg text-lg">
                                <option value="1000">–ú—ñ—Å—Ç–æ (–°—Ç–∞–Ω–¥–∞—Ä—Ç): 1000 –≥—Ä–Ω</option>
                                <option value="1500">–¶–µ–Ω—Ç—Ä/–°–∫–ª–∞–¥–Ω–∏–π –∑–∞—ó–∑–¥: 1500 –≥—Ä–Ω</option>
                                <option value="2500">–ó–∞ –º—ñ—Å—Ç–æ (–¥–æ 30–∫–º): 2500 –≥—Ä–Ω</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="flex justify-between mt-8">
                    <button onclick="showTab(1)" class="lair-btn-primary py-3 px-6 rounded-lg text-lg bg-neutral-600 hover:bg-neutral-700"><i class="fas fa-arrow-left mr-2"></i> –ù–∞–∑–∞–¥</button>
                    <button onclick="showTab(3)" class="lair-btn-primary py-3 px-6 rounded-lg text-lg"><i class="fas fa-check-circle mr-2"></i> –î–∞–ª—ñ: –§—ñ–Ω–∞–ª—ñ–∑–∞—Ü—ñ—è</button>
                </div>
            </div>

            <div id="tab-3" class="tab-content card p-8 shadow-2xl hidden">
                <h2 class="text-2xl font-bold mb-6 accent-color"><i class="fas fa-id-card-alt mr-2"></i> –û—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è —Ç–∞ –ö–æ–Ω—Ç–∞–∫—Ç–∏</h2>
                
                <form id="orderForm" class="space-y-4">
                    <input type="text" id="clientName" placeholder="–Ü–º'—è —Ç–∞ –ü—Ä—ñ–∑–≤–∏—â–µ (–û–±–æ–≤'—è–∑–∫–æ–≤–æ)" required class="lair-input w-full p-4 rounded-lg text-base">
                    <input type="tel" id="clientPhone" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω (–û–±–æ–≤'—è–∑–∫–æ–≤–æ)" required class="lair-input w-full p-4 rounded-lg text-base">
                    <input type="email" id="clientEmail" placeholder="Email (–ë–∞–∂–∞–Ω–æ –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è)" class="lair-input w-full p-4 rounded-lg text-base">
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <input type="date" id="eventDate" placeholder="–î–∞—Ç–∞ —ñ–≤–µ–Ω—Ç—É" required class="lair-input w-full p-4 rounded-lg text-base appearance-none">
                        <input type="text" id="eventLocation" placeholder="–ê–¥—Ä–µ—Å–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–Ω—è (–ú—ñ—Å—Ç–æ/–í—É–ª–∏—Ü—è)" class="lair-input w-full p-4 rounded-lg text-base">
                    </div>
                    
                    <textarea id="eventNotes" placeholder="–î–æ–¥–∞—Ç–∫–æ–≤—ñ –ø–æ–±–∞–∂–∞–Ω–Ω—è —Ç–∞ –¥–µ—Ç–∞–ª—ñ" rows="3" class="lair-input w-full p-4 rounded-lg text-base"></textarea>

                    <div class="pt-6 border-t border-neutral-600">
                        <span class="font-bold text-xl block mb-2">–ó–Ω–∏–∂–∫–∞ –ö–ª—ñ—î–Ω—Ç—É (%)</span>
                        <div class="flex items-center gap-4">
                            <input type="range" id="discount" min="0" max="30" value="10" step="5" class="w-full">
                            <span id="discountVal" class="font-extrabold text-3xl w-12 text-right accent-color">10</span>
                            <span>%</span>
                        </div>
                    </div>
                </form>
                
                <div id="validationError" class="mt-4 hidden font-bold text-red-400 p-3 border border-red-500 rounded bg-red-900/20 text-center">
                    <i class="fas fa-exclamation-triangle mr-2"></i> –ü–æ–º–∏–ª–∫–∞: –ó–∞–ø–æ–≤–Ω—ñ—Ç—å –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ –ø–æ–ª—è (–Ü–º'—è, –¢–µ–ª–µ—Ñ–æ–Ω, –î–∞—Ç–∞).
                </div>

                <div class="flex justify-between mt-8">
                    <button onclick="showTab(2)" class="lair-btn-primary py-3 px-6 rounded-lg text-lg bg-neutral-600 hover:bg-neutral-700"><i class="fas fa-arrow-left mr-2"></i> –ù–∞–∑–∞–¥</button>
                    <button onclick="submitOrder()" class="lair-btn-primary py-4 px-8 rounded-lg text-xl font-bold"><i class="fas fa-paper-plane mr-2"></i> –ü–Ü–î–¢–í–ï–†–î–ò–¢–ò –ó–ê–ú–û–í–õ–ï–ù–ù–Ø</button>
                </div>
            </div>
            
            <div class="text-center pt-4">
                <button id="toggleSettings" class="text-sm text-neutral-500 hover:text-neutral-300 underline"><i class="fas fa-cog mr-1"></i> –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –±–∞–∑–æ–≤—ñ —Ü—ñ–Ω–∏</button>
            </div>
            <div id="settingsPanel" class="hidden card p-4 rounded-xl text-sm mt-4">
                <h3 class="font-bold mb-3 accent-color">–ë–∞–∑–æ–≤—ñ —Ü—ñ–Ω–∏ –æ—Ä–µ–Ω–¥–∏ –∑–∞ 1 –æ–¥–∏–Ω–∏—Ü—é (–≥—Ä–Ω/–¥–æ–±–∞)</h3>
                <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                    <label class="block">–ù–æ—É—Ç–±—É–∫: <input type="number" id="basePriceLaptop" value="1500" min="0" class="w-full lair-input px-2 py-1"></label>
                    <label class="block">PS5: <input type="number" id="basePricePS5" value="1200" min="0" class="w-full lair-input px-2 py-1"></label>
                    <label class="block">VR: <input type="number" id="basePriceVR" value="1800" min="0" class="w-full lair-input px-2 py-1"></label>
                    <label class="block">–¢–í: <input type="number" id="basePriceTV" value="1000" min="0" class="w-full lair-input px-2 py-1"></label>
                    <label class="block">–ê–¥–º—ñ–Ω/–≥–æ–¥: <input type="number" id="basePriceAdmin" value="300" min="0" class="w-full lair-input px-2 py-1"></label>
                </div>
            </div>

        </div>

        <div class="col-span-1">
            <div class="card p-8 shadow-2xl sticky top-6 border-t-4 border-t-red-700">
                <h2 class="text-3xl font-extrabold mb-6 text-center accent-color">üßæ –ö–æ—à—Ç–æ—Ä–∏—Å <span class="text-sm text-neutral-400">(Live)</span></h2>
                
                <div class="space-y-4 text-base border-b border-neutral-600 pb-5 mb-5">
                    <div class="flex justify-between items-center">
                        <span class="text-neutral-300">–û–±–ª–∞–¥–Ω–∞–Ω–Ω—è:</span>
                        <span id="equipTotal" class="font-bold">0 ‚Ç¥</span>
                    </div>
                    <div id="staffRow" class="flex justify-between items-center">
                        <span class="text-neutral-300">–ü–µ—Ä—Å–æ–Ω–∞–ª (<span id="summaryHours">6</span> –≥–æ–¥):</span>
                        <span id="staffTotal" class="font-bold">0 ‚Ç¥</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="text-neutral-300">–õ–æ–≥—ñ—Å—Ç–∏–∫–∞/–ú–æ–Ω—Ç–∞–∂:</span>
                        <span id="deliveryTotal" class="font-bold">0 ‚Ç¥</span>
                    </div>
                    <div class="flex justify-between items-center pt-2 border-t border-neutral-700">
                        <span class="text-xl font-bold">–ó–∞–≥–∞–ª—å–Ω–∞ –°—É–º–∞:</span>
                        <span id="subtotal" class="text-xl font-bold">0 ‚Ç¥</span>
                    </div>
                </div>

                <div class="flex justify-between items-center mb-6 text-orange-400">
                    <span class="text-lg">–ó–Ω–∏–∂–∫–∞ (<span id="discountSummary">10</span>%):</span>
                    <span id="discountAmount" class="text-lg font-bold">-0 ‚Ç¥</span>
                </div>

                <div class="bg-black rounded-lg p-5 text-center border border-red-700">
                    <p class="text-neutral-400 text-base mb-1">–î–û –°–ü–õ–ê–¢–ò</p>
                    <p id="finalTotal" class="text-5xl font-extrabold text-green-400">0 ‚Ç¥</p>
                </div>
                
                <button onclick="copyToClipboard()" class="w-full mt-6 bg-neutral-600 hover:bg-neutral-700 text-white font-bold py-3 px-4 rounded-lg transition duration-200 text-sm">
                    <i class="fas fa-copy mr-2"></i> –ö–æ–ø—ñ—é–≤–∞—Ç–∏ –ö–æ—à—Ç–æ—Ä–∏—Å
                </button>

                <div class="mt-6 text-xs text-neutral-500 text-center">
                    * –ó –í–∞–º–∏ –∑–≤'—è–∂–µ—Ç—å—Å—è –º–µ–Ω–µ–¥–∂–µ—Ä –¥–ª—è –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è.
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- Configuration ---
        // –ó–ê–ú–Ü–ù–Ü–¢–¨ –¶–ï–ô URL –ù–ê –í–ê–® GOOGLE APPS SCRIPT WEB APP URL
        const APPS_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxpxXWq8zhMM0ifO_cgZavHgrUq96RhlNy4aLA5qL0enEFpX4Luk7Xgf88S8s-cpHvlWg/exec'; 

        // --- State and Logic ---
        const state = {
            laptops: 4, ps5: 2, vr: 1, tv: 2,
            operator: true, hours: 6,
            delivery: true, deliveryCost: 1000,
            discount: 10,
            prices: {
                laptop: 1500, ps5: 1200, vr: 1800, tv: 1000, adminPerHour: 300
            }
        };

        const inputs = {
            laptops: document.getElementById('laptops'), ps5: document.getElementById('ps5'), vr: document.getElementById('vr'), tv: document.getElementById('tv'),
            operator: document.getElementById('operator'), hours: document.getElementById('hours'),
            delivery: document.getElementById('delivery'), deliveryZone: document.getElementById('deliveryZone'), discount: document.getElementById('discount'),
            clientName: document.getElementById('clientName'), clientPhone: document.getElementById('clientPhone'), clientEmail: document.getElementById('clientEmail'),
            eventLocation: document.getElementById('eventLocation'), eventDate: document.getElementById('eventDate'), eventNotes: document.getElementById('eventNotes'),
            basePriceLaptop: document.getElementById('basePriceLaptop'), basePricePS5: document.getElementById('basePricePS5'), basePriceVR: document.getElementById('basePriceVR'),
            basePriceTV: document.getElementById('basePriceTV'), basePriceAdmin: document.getElementById('basePriceAdmin'),
        };
        
        const displays = {
            laptopCount: document.getElementById('laptopCountVal'), ps5Count: document.getElementById('ps5CountVal'), vrCount: document.getElementById('vrCountVal'), tvCount: document.getElementById('tvCountVal'),
            hoursVal: document.getElementById('hoursVal'), discountVal: document.getElementById('discountVal'),
            equipTotal: document.getElementById('equipTotal'), staffTotal: document.getElementById('staffTotal'), deliveryTotal: document.getElementById('deliveryTotal'),
            subtotal: document.getElementById('subtotal'), discountAmount: document.getElementById('discountAmount'), finalTotal: document.getElementById('finalTotal'),
            summaryHours: document.getElementById('summaryHours'), discountSummary: document.getElementById('discountSummary'), staffRow: document.getElementById('staffRow'),
            validationError: document.getElementById('validationError')
        };

        const tabs = {
            'tab-1': document.getElementById('tab-1'),
            'tab-2': document.getElementById('tab-2'),
            'tab-3': document.getElementById('tab-3'),
        };

        // --- Core Functions ---

        function showTab(tabNumber) {
            const tabId = `tab-${tabNumber}`;
            Object.values(tabs).forEach(tab => tab.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');

            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(`${tabId}-btn`).classList.add('active');
        }

        function calculate() {
            // 1. Update State & Prices from Inputs
            state.laptops = parseInt(inputs.laptops.value) || 0;
            state.ps5 = parseInt(inputs.ps5.value) || 0;
            state.vr = parseInt(inputs.vr.value) || 0;
            
            // LOGIC FIX: TV count should be at least equal to PS5 count
            state.tv = Math.max(parseInt(inputs.tv.value) || 0, state.ps5);
            inputs.tv.value = state.tv; // Update slider position if it was less than PS5

            state.operator = inputs.operator.checked;
            
            // LOGIC FIX: Minimum 4 hours if operator is selected
            state.hours = state.operator ? Math.max(parseInt(inputs.hours.value) || 4, 4) : 0;
            inputs.hours.min = state.operator ? 4 : 0; 
            if (state.operator && parseInt(inputs.hours.value) < 4) {
                 inputs.hours.value = 4;
                 state.hours = 4;
            }

            state.delivery = inputs.delivery.checked;
            state.deliveryCost = state.delivery ? parseInt(inputs.deliveryZone.value) : 0;
            state.discount = parseInt(inputs.discount.value);

            // Update Manager Prices
            state.prices.laptop = parseInt(inputs.basePriceLaptop.value) || 0;
            state.prices.ps5 = parseInt(inputs.basePricePS5.value) || 0;
            state.prices.vr = parseInt(inputs.basePriceVR.value) || 0;
            state.prices.tv = parseInt(inputs.basePriceTV.value) || 0;
            state.prices.adminPerHour = parseInt(inputs.basePriceAdmin.value) || 0;

            // 2. Update UI Counters
            displays.laptopCount.innerText = state.laptops;
            displays.ps5Count.innerText = state.ps5;
            displays.vrCount.innerText = state.vr;
            displays.tvCount.innerText = state.tv;
            displays.hoursVal.innerText = state.hours;
            displays.discountVal.innerText = state.discount;
            displays.discountSummary.innerText = state.discount;
            displays.summaryHours.innerText = state.hours;

            // 3. Calculations
            const equipCost = 
                (state.laptops * state.prices.laptop) + 
                (state.ps5 * state.prices.ps5) + 
                (state.vr * state.prices.vr) +
                (state.tv * state.prices.tv);

            const staffCost = state.operator ? (state.prices.adminPerHour * state.hours) : 0;
            const deliveryCost = state.delivery ? state.deliveryCost : 0;

            const subtotal = equipCost + staffCost + deliveryCost;
            const discountAmount = Math.round(subtotal * (state.discount / 100));
            const finalTotal = subtotal - discountAmount;

            // 4. Render Results
            displays.equipTotal.innerText = equipCost.toLocaleString() + ' ‚Ç¥';
            displays.staffTotal.innerText = staffCost.toLocaleString() + ' ‚Ç¥';
            displays.deliveryTotal.innerText = deliveryCost.toLocaleString() + ' ‚Ç¥';
            displays.subtotal.innerText = subtotal.toLocaleString() + ' ‚Ç¥';
            displays.discountAmount.innerText = '-' + discountAmount.toLocaleString() + ' ‚Ç¥';
            displays.finalTotal.innerText = finalTotal.toLocaleString() + ' ‚Ç¥';
            
            // Toggle staff row visibility
            displays.staffRow.style.display = state.operator ? 'flex' : 'none';
        }
        
        // --- Form Validation and Submission ---

        function validateForm() {
            let isValid = true;
            
            // Check required fields and add error class
            const requiredFields = [inputs.clientName, inputs.clientPhone, inputs.eventDate];
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('border-red-500');
                    isValid = false;
                } else {
                    field.classList.remove('border-red-500');
                }
            });

            if (!isValid) {
                displays.validationError.classList.remove('hidden');
                // Force user back to tab 3 if validation fails
                showTab(3);
            } else {
                displays.validationError.classList.add('hidden');
            }

            return isValid;
        }

        async function submitOrder() {
            if (!validateForm()) {
                return;
            }

            // Recalculate just to be sure
            calculate(); 
            const finalTotal = parseFloat(displays.finalTotal.innerText.replace(/[ ‚Ç¥]/g, ''));
            
            const orderData = {
                'ClientName': inputs.clientName.value.trim(),
                'ClientPhone': inputs.clientPhone.value.trim(),
                'ClientEmail': inputs.clientEmail.value.trim(),
                'EventLocation': inputs.eventLocation.value.trim(),
                'EventDate': inputs.eventDate.value,
                'EventNotes': inputs.eventNotes.value.trim(),
                
                'EquipDetails': {
                    'Laptops': state.laptops, 'PS5': state.ps5, 'VR': state.vr, 'TVs': state.tv,
                    'EquipTotal': parseFloat(displays.equipTotal.innerText.replace(/[ ‚Ç¥]/g, ''))
                },
                'ServiceDetails': {
                    'Operator': state.operator ? '–¢–∞–∫' : '–ù—ñ',
                    'Hours': state.hours,
                    'StaffTotal': parseFloat(displays.staffTotal.innerText.replace(/[ ‚Ç¥]/g, '')),
                    'DeliveryZone': inputs.deliveryZone.options[inputs.deliveryZone.selectedIndex].text,
                    'DeliveryTotal': parseFloat(displays.deliveryTotal.innerText.replace(/[ ‚Ç¥]/g, ''))
                },

                'Subtotal': parseFloat(displays.subtotal.innerText.replace(/[ ‚Ç¥]/g, '')),
                'DiscountPercent': state.discount,
                'DiscountAmount': parseFloat(displays.discountAmount.innerText.replace(/[^0-9]/g, '')),
                'FinalTotal': finalTotal,
                'Timestamp': new Date().toISOString()
            };

            // Visual feedback - loading state
            const submitBtn = document.querySelector('button[onclick="submitOrder()"]');
            const originalBtnText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> –û–±—Ä–æ–±–∫–∞...';
            submitBtn.disabled = true;

            try {
                 const response = await fetch(APPS_SCRIPT_URL, {
                     method: 'POST',
                     mode: 'no-cors', 
                     headers: {
                         'Content-Type': 'application/json',
                     },
                     body: JSON.stringify(orderData)
                 });

                 alert(`‚úÖ –ó–∞–º–æ–≤–ª–µ–Ω–Ω—è –Ω–∞ —Å—É–º—É ${finalTotal.toLocaleString()} ‚Ç¥ –ø—Ä–∏–π–Ω—è—Ç–æ! –ú–µ–Ω–µ–¥–∂–µ—Ä LAIR –∑–≤'—è–∂–µ—Ç—å—Å—è –∑ –í–∞–º–∏.`);
                 
                 document.getElementById('orderForm').reset();
                 // Reset defaults
                 inputs.laptops.value = 4;
                 inputs.ps5.value = 2;
                 calculate();
                 showTab(1); 

            } catch (error) {
                console.error('Error submitting order:', error);
                alert('‚ö†Ô∏è –í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞. –ë—É–¥—å –ª–∞—Å–∫–∞, —Å–∫–æ–ø—ñ—é–π—Ç–µ –∫–æ—à—Ç–æ—Ä–∏—Å —ñ –∑–≤\'—è–∂—ñ—Ç—å—Å—è –∑ –Ω–∞–º–∏.');
            } finally {
                submitBtn.innerHTML = originalBtnText;
                submitBtn.disabled = false;
            }
        }

        function copyToClipboard() {
            const finalTotalText = displays.finalTotal.innerText;
            const subtotal = parseFloat(displays.subtotal.innerText.replace(/[ ‚Ç¥]/g, ''));
            const discountAmount = parseFloat(displays.discountAmount.innerText.replace(/[^0-9]/g, ''));

            const text = `üéâ –ö–æ—à—Ç–æ—Ä–∏—Å –æ—Ä–µ–Ω–¥–∏ –æ–±–ª–∞–¥–Ω–∞–Ω–Ω—è LAIR üéâ\n\n` +
                `üë§ –ö–ª—ñ—î–Ω—Ç: ${inputs.clientName.value.trim() || '–ö–ª—ñ—î–Ω—Ç LAIR'}\n` +
                `üìÖ –î–∞—Ç–∞ –Ü–≤–µ–Ω—Ç—É: ${inputs.eventDate.value || '–ù–µ –≤–∫–∞–∑–∞–Ω–æ'}\n` +
                `\n` +
                `--- –î–µ—Ç–∞–ª—ñ–∑–∞—Ü—ñ—è ---\n` +
                `- –ù–æ—É—Ç–±—É–∫–∏ (${state.laptops} —à—Ç): ${(state.laptops * state.prices.laptop).toLocaleString()} –≥—Ä–Ω\n` +
                `- PS5 (${state.ps5} —à—Ç): ${(state.ps5 * state.prices.ps5).toLocaleString()} –≥—Ä–Ω\n` +
                `- VR (${state.vr} —à—Ç): ${(state.vr * state.prices.vr).toLocaleString()} –≥—Ä–Ω\n` +
                `- –¢–í/–°—Ç—ñ–π–∫–∏ (${state.tv} —à—Ç): ${(state.tv * state.prices.tv).toLocaleString()} –≥—Ä–Ω\n` +
                `- –¢–µ—Ö. –∞–¥–º—ñ–Ω (${state.hours} –≥–æ–¥): ${(state.operator ? (state.prices.adminPerHour * state.hours) : 0).toLocaleString()} –≥—Ä–Ω\n` +
                `- –õ–æ–≥—ñ—Å—Ç–∏–∫–∞: ${(state.delivery ? state.deliveryCost : 0).toLocaleString()} –≥—Ä–Ω\n` +
                `\n` +
                `‚û°Ô∏è –°—É–º–∞ –¥–æ –∑–Ω–∏–∂–∫–∏: ${subtotal.toLocaleString()} –≥—Ä–Ω\n` +
                `üéÅ –ó–Ω–∏–∂–∫–∞ ${state.discount}%: -${discountAmount.toLocaleString()} –≥—Ä–Ω\n` +
                `================\n` +
                `üî• –†–ê–ó–û–ú –î–û –°–ü–õ–ê–¢–ò: ${finalTotalText}\n\n` +
                `–î–ª—è –æ—Ñ–æ—Ä–º–ª–µ–Ω–Ω—è –∑–∞–º–æ–≤–ª–µ–Ω–Ω—è –ø–µ—Ä–µ–π–¥—ñ—Ç—å –∑–∞ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º –∞–±–æ –¥–∞–π—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—å –Ω–∞ —Ü–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è.`;
            
            navigator.clipboard.writeText(text).then(() => {
                alert("–ö–æ—à—Ç–æ—Ä–∏—Å —Å–∫–æ–ø—ñ–π–æ–≤–∞–Ω–æ –≤ –±—É—Ñ–µ—Ä –æ–±–º—ñ–Ω—É!");
            }).catch(err => {
                alert("–ù–µ –≤–¥–∞–ª–æ—Å—è —Å–∫–æ–ø—ñ—é–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ. –ë—É–¥—å –ª–∞—Å–∫–∞, –≤–∏–¥—ñ–ª—ñ—Ç—å —Ç–µ–∫—Å—Ç —ñ —Å–∫–æ–ø—ñ—é–π—Ç–µ –≤—Ä—É—á–Ω—É.");
            });
        }

        // --- Event Listeners and Init ---

        // Listen for changes on all relevant inputs
        Object.values(inputs).forEach(input => {
             // Attach event listeners
             if (input.type === 'range' || input.type === 'checkbox' || input.tagName === 'SELECT') {
                 input.addEventListener('input', calculate);
             }
             if (input.type === 'number') {
                 input.addEventListener('change', calculate);
             }
        });
        
        // Listener for operator to reset hours
        inputs.operator.addEventListener('change', () => {
             if (inputs.operator.checked) {
                 inputs.hours.value = 6; 
             } else {
                 inputs.hours.value = 0;
             }
             calculate();
        });

        document.getElementById('toggleSettings').addEventListener('click', () => {
            document.getElementById('settingsPanel').classList.toggle('hidden');
        });

        // Initial setup
        calculate();
        showTab(1); 
    </script>
</body>
</html>
